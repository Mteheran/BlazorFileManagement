@page "/fileazure"
@using System.Text.RegularExpressions
@using System.IO
@inject HttpClient Http

<InputFile OnChange="@OnInputFileChange"  class="btn btn-primary" />   

<div class="form-group">
    <p>@file?.Name</p>
    <p>@file?.ContentType</p>
    <p>@(file?.Size != null ? file?.Size/1024 + " KBs" : "")</p>
    <p>@file?.LastModified</p>
</div>

<button class="btn btn-default" @onclick="SaveInAzure" >Save in Azure</button>

@code
{
    IBrowserFile file;
    List<string[]> csvData = new List<string[]>();  
    public async Task OnInputFileChange(InputFileChangeEventArgs e)  
    {  
        file = e.File;
        Regex regex = new Regex(".+\\.csv", RegexOptions.Compiled);  
        if (regex.IsMatch(file.Name))
        {  
            var stream = file.OpenReadStream(); 
            MemoryStream ms = new MemoryStream();  
            await stream.CopyToAsync(ms);  
            stream.Close();  
            var outputFileString = System.Text.Encoding.UTF8.GetString(ms.ToArray()); 
        }  
    }  

    private string[] SplitCSV(string input)  
    {  
        //Excludes commas within quotes  
        Regex csvSplit = new Regex("(?:^|,)(\"(?:[^\"]+|\"\")*\"|[^,]*)", RegexOptions.Compiled);  
        List<string> list = new List<string>();  
        string curr = null;  
        foreach (Match match in csvSplit.Matches(input))  
        {  
            curr = match.Value;  
            if (0 == curr.Length)  list.Add(""); 
            list.Add(curr.TrimStart(','));  
        }  
    
        return list.ToArray();  
    }  

    protected async Task SaveInAzure()
    {
        BlazorFile FileToSave = new BlazorFile();
        FileToSave.FileName = file?.Name;


        // reading file from memory
        var stream = file.OpenReadStream(); 
        MemoryStream ms = new MemoryStream();  
        await stream.CopyToAsync(ms);  
        stream.Close();  

        FileToSave.FileInfo = ms.ToArray();
        await Http.PostAsJsonAsync("File", FileToSave);
    }
  
}